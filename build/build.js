!function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){window.ABLAST={},i(1),i(2),i(3),i(5),i(6),i(7),i(8),i(9),i(10),i(11),i(12),i(13),i(14),i(15),i(16),i(17),i(18),i(19),i(20),i(21),i(22),i(23),i(24),i(25),i(26),i(27),i(29),i(30),i(31),i(32),i(33),i(34),i(35),i(36),i(37),i(38),i(39),i(42),i(43)},function(t,e){AFRAME.registerElement("a-asset-image",{prototype:Object.create(AFRAME.ANode.prototype,{createdCallback:{value:function(){this.isAssetItem=!0}},attachedCallback:{value:function(){var t=this.getAttribute("src"),e=new THREE.ImageLoader;e.load(t,this.onImageLoaded.bind(this))}},onImageLoaded:{value:function(){AFRAME.ANode.prototype.load.call(this)}}})})},function(t,e){function i(t,e,i){var n=document.createElement("a-mixin");n.setAttribute("id",t),Object.keys(e).forEach(function(t){var i=e[t];"object"==typeof i&&(i=AFRAME.utils.styleParser.stringify(i)),n.setAttribute(t,i)});var s=i?i.querySelector("a-assets"):document.querySelector("a-assets");return s||(s=document.createElement("a-assets"),i.appendChild(s)),s.appendChild(n),n}Number.prototype.padLeft=function(t,e){return Array(t-String(this).length+1).join(e||"0")+this},String.prototype.pad=function(t,e,i){var n=String(this).substr(0,t),s=Array(t-n.length+1).join(i||" ");return e?s+this:this+s},t.exports={createMixin:i}},function(t,e,i){var n=i(4);ABLAST.BULLETS={},ABLAST.registerBullet=function(t,e,i){if(ABLAST.BULLETS[t])throw new Error("The bullet `"+t+"` has been already registered. Check that you are not loading two versions of the same bullet or two different bullets of the same name.");ABLAST.BULLETS[t]={poolSize:e.poolSize,components:e.components,definition:i},console.info("Bullet registered ",t)},AFRAME.registerSystem("bullet",{init:function(){var t=this;this.poolHelper=new n("bullet",ABLAST.BULLETS,this.sceneEl),this.activeBullets=[],this.sceneEl.addEventListener("gamestate-changed",function(e){"state"in e.detail.diff&&("STATE_GAME_OVER"!==e.detail.state.state&&"STATE_GAME_WIN"!==e.detail.state.state||t.reset())})},reset:function(t){var e=this;this.activeBullets.forEach(function(t){e.returnBullet(t.getAttribute("bullet").name,t)})},returnBullet:function(t,e){this.activeBullets.splice(this.activeBullets.indexOf(e),1),this.poolHelper.returnEntity(t,e)},getBullet:function(t){var e=this.poolHelper.requestEntity(t);return this.activeBullets.push(e),e}})},function(t,e,i){var n=i(2).createMixin,s=function(t,e,i){this.groupName=t,this.sceneEl=i||document.querySelector("a-scene"),this.initializePools(t,e)};s.prototype={initializePools:function(t,e){var i=this;Object.keys(e).forEach(function(s){var o=e[s],a=o.components,r=t+s;n(r,a,i.sceneEl),i.sceneEl.setAttribute("pool__"+r,{size:o.poolSize,mixin:r,dynamic:!0})})},returnEntity:function(t,e){var i=this.groupName+t,n="pool__"+i;this.sceneEl.components[n].returnEntity(e)},requestEntity:function(t){var e=this.groupName+t,i="pool__"+e,n=this.sceneEl.components[i].requestEntity();return n}},t.exports=s},function(t,e,i){var n=i(4);ABLAST.ENEMIES={},ABLAST.registerEnemy=function(t,e,i){if(ABLAST.ENEMIES[t])throw new Error("The enemy `"+t+"` has been already registered. Check that you are not loading two versions of the same enemy or two different enemies of the same name.");ABLAST.ENEMIES[t]={poolSize:e.poolSize,components:e.components,definition:i,name:t},console.info("Enemy registered ",t)},AFRAME.registerSystem("enemy",{schema:{wave:{default:0}},init:function(){var t=this,e=this.sceneEl;return e.hasLoaded?(this.poolHelper=new n("enemy",ABLAST.ENEMIES,this.sceneEl),this.activeEnemies=[],void e.addEventListener("gamestate-changed",function(e){if("state"in e.detail.diff)if("STATE_PLAYING"===e.detail.state.state)setTimeout(function(){t.createWave(0)},1e3);else if("STATE_GAME_OVER"===e.detail.state.state||"STATE_GAME_WIN"===e.detail.state.state||"STATE_MAIN_MENU"===e.detail.state.state)return void t.reset();"waveSequence"in e.detail.diff&&t.createSequence(e.detail.state.waveSequence),"wave"in e.detail.diff&&t.createWave(e.detail.state.wave)})):void e.addEventListener("loaded",this.init.bind(this))},getEnemy:function(t){return this.poolHelper.requestEntity(t)},onEnemyDeath:function(t,e){"STATE_MAIN_MENU"===this.sceneEl.getAttribute("gamestate").state?this.sceneEl.emit("start-game"):(this.poolHelper.returnEntity(t,e),this.sceneEl.emit("enemy-death"))},createSequence:function(t){var e=this,i=this.currentWave.sequences[t].start||0;setTimeout(function(){e.currentSequence=t;var i=e.currentWave.sequences[t];i.enemies.forEach(function(t){e.createEnemies(t)})},i)},createWave:function(t){this.currentWave=WAVES[t%WAVES.length],this.createSequence(0),this.sceneEl.emit("wave-created",{wave:this.currentWave})},createEnemy:function(t,e,i){function n(t){t.setAttribute("visible",!0),t.components["curve-movement"].addPoints(e.points),t.play(),s.activeEnemies.push(t),s.sceneEl.emit("enemy-spawn",{enemy:t})}var s=this,o=this.getEnemy(t);o.setAttribute("enemy",{shootingDelay:3e3}),o.setAttribute("curve-movement",{type:e.movement,loopStart:e.loopStart||1,timeOffset:i||0}),i?i<0&&(o.setAttribute("visible",!1),setTimeout(function(){n(o)},-i)):n(o)},createEnemies:function(t){if(Array.isArray(t.type))for(var e=0;e<t.type.length;e++){var i=t.type[e],n=(t.enemyTimeOffset||0)*e;this.createEnemy(i,t,n)}else this.createEnemy(t.type,t)},reset:function(t){var e=this;this.activeEnemies.forEach(function(t){e.poolHelper.returnEntity(t.getAttribute("enemy").name,t)})}})},function(t,e,i){var n=i(4);ABLAST.EXPLOSIONS={},ABLAST.registerExplosion=function(t,e,i){if(ABLAST.EXPLOSIONS[t])throw new Error("The explosion `"+t+"` has been already registered. Check that you are not loading two versions of the same explosion or two different enemies of the same name.");ABLAST.EXPLOSIONS[t]={poolSize:e.poolSize,components:e.components,definition:i,name:t},console.info("Explosion registered ",t)},AFRAME.registerSystem("explosion",{schema:{wave:{default:0}},init:function(){this.poolHelper=new n("explosion",ABLAST.EXPLOSIONS,this.sceneEl),this.activeExplosions=[],this.sounds={enemy_start:document.getElementById("explosion0"),enemy0:document.getElementById("explosion0"),enemy1:document.getElementById("explosion1"),enemy2:document.getElementById("explosion2"),enemy3:document.getElementById("explosion3"),bullet:document.getElementById("hitbullet"),background:document.getElementById("hitbullet")},this.soundVolumes={enemy_start:.7,enemy0:1,enemy1:1,enemy2:1,enemy3:1,bullet:.4,background:.2}},reset:function(t){var e=this;this.activeExplosions.forEach(function(t){e.returnToPool(t.getAttribute("explosion").name,t)})},returnToPool:function(t,e){this.activeExplosions.splice(this.activeExplosions.indexOf(e),1),this.poolHelper.returnEntity(t,e)},getFromPool:function(t){var e=this.poolHelper.requestEntity(t);return this.activeExplosions.push(e),e},createExplosion:function(t,e,i,n,s,o){var a=this.getFromPool(t);a.setAttribute("position",e||this.el.getAttribute("position")),a.setAttribute("explosion",{type:t,lookAt:s.clone(),color:i||"#FFF",scale:n||1}),a.setAttribute("sound",{src:this.sounds[o||t].src,volume:this.soundVolumes[o||t],poolSize:15,autoplay:!0}),a.setAttribute("visible",!0),a.play()}}),ABLAST.registerExplosion("enemy",{components:{explosion:{type:"enemy"}},poolSize:10},{}),ABLAST.registerExplosion("enemygun",{components:{explosion:{type:"enemygun"}},poolSize:10},{}),ABLAST.registerExplosion("bullet",{components:{explosion:{type:"bullet"}},poolSize:10},{}),ABLAST.registerExplosion("background",{components:{explosion:{type:"background"}},poolSize:10},{})},function(t,e){ABLAST.registerBullet("default",{components:{bullet:{name:"default",maxSpeed:1,initialSpeed:.1,acceleration:.4,color:"#24CAFF"},"collision-helper":{debug:!1,radius:.2},"json-model":{src:"#playerBullet"}},poolSize:10},{init:function(){var t=this.el,e=this.bullet.components.bullet.color;t.setAttribute("material","color",e),t.setAttribute("scale",{x:.2,y:.2,z:.2}),this.trail=null;var i=this;t.addEventListener("model-loaded",function(t){i.trail=i.el.getObject3D("mesh").getObjectByName("trail"),i.trail.scale.setY(.001)})},reset:function(){var t=this.el;t.setAttribute("scale",{x:.2,y:.2,z:.2}),this.trail&&this.trail.scale.setY(.001)},tick:function(t,e){if(this.trail&&this.trail.scale.y<1){var i;i=this.trail.scale.y<.005?this.trail.scale.y+.001:this.trail.scale.y+e/50,i>1&&(i=1),this.trail.scale.setY(i)}},onHit:function(t){this.el.setAttribute("material","color","#FFF")}})},function(t,e){ABLAST.registerBullet("enemy-slow",{components:{bullet:{name:"enemy-slow",maxSpeed:.5,initialSpeed:.1,acceleration:.03,destroyable:!0,color:"#FFB911"},"collision-helper":{debug:!1,radius:.13},"json-model":{src:"#enemyBullet"}},poolSize:10},{init:function(){var t=this.el,e=this.bullet.components.bullet.color;t.setAttribute("material","color",e),t.setAttribute("scale",{x:.13,y:.13,z:.13}),this.trail=null,this.glow=null;var i=this;t.addEventListener("model-loaded",function(t){t.detail.model.children[0].material.color.setStyle(e),i.trail=i.el.getObject3D("mesh").getObjectByName("trail"),i.trail.scale.setY(.001),i.glow=i.el.getObject3D("mesh").getObjectByName("glow")})},reset:function(){var t=this.el;t.setAttribute("scale",{x:.13,y:.13,z:.13}),this.trail&&this.trail.scale.setY(.001)},tick:function(t,e){if(this.trail&&this.trail.scale.y<.3){var i=this.trail.scale.y+e/1e3;i>.3&&(i=.3),this.trail.scale.setY(i)}if(this.glow){var n=1+.1*Math.sin(t/20);this.glow.scale.set(n,n,n)}},onHit:function(t){}})},function(t,e){ABLAST.registerBullet("enemy-medium",{components:{bullet:{name:"enemy-medium",maxSpeed:.5,initialSpeed:.1,acceleration:.06,destroyable:!0,color:"#FF5533"},"collision-helper":{debug:!1,radius:.16},"json-model":{src:"url(assets/models/enemy-bullet.json)"}},poolSize:10},{init:function(){var t=this.el,e=this.bullet.components.bullet.color;t.setAttribute("material","color",e),t.setAttribute("scale",{x:.16,y:.16,z:.16}),this.trail=null,this.glow=null;var i=this;t.addEventListener("model-loaded",function(t){t.detail.model.children[0].material.color.setStyle(e),i.trail=i.el.getObject3D("mesh").getObjectByName("trail"),i.trail.scale.setY(.001),i.glow=i.el.getObject3D("mesh").getObjectByName("glow")})},reset:function(){var t=this.el;t.setAttribute("scale",{x:.13,y:.13,z:.13}),this.trail&&this.trail.scale.setY(.001)},tick:function(t,e){if(this.trail&&this.trail.scale.y<.3){var i=this.trail.scale.y+e/1e3;i>.3&&(i=.3),this.trail.scale.setY(i)}if(this.glow){var n=1+.1*Math.sin(t/20);this.glow.scale.set(n,n,n)}},onHit:function(t){}})},function(t,e){ABLAST.registerBullet("enemy-fast",{components:{bullet:{name:"enemy-fast",maxSpeed:.1,initialSpeed:.1,acceleration:.1,destroyable:!0,color:"#FF7F00"},"collision-helper":{debug:!1,radius:.1},"json-model":{src:"#enemyBullet"}},poolSize:10},{init:function(){var t=this.el,e=this.bullet.components.bullet.color;t.setAttribute("material","color",e),t.setAttribute("scale",{x:.09,y:.09,z:.09}),this.trail=null,this.glow=null;var i=this;t.addEventListener("model-loaded",function(t){t.detail.model.children[0].material.color.setStyle(e),i.trail=i.el.getObject3D("mesh").getObjectByName("trail"),i.trail.scale.setY(.001),i.glow=i.el.getObject3D("mesh").getObjectByName("glow")})},reset:function(){var t=this.el;t.setAttribute("scale",{x:.09,y:.09,z:.09}),this.trail&&this.trail.scale.setY(.001)},tick:function(t,e){if(this.trail&&this.trail.scale.y<1){var i=this.trail.scale.y+e/1e3;i>1&&(i=1),this.trail.scale.setY(i)}if(this.glow){var n=1+.1*Math.sin(t/10);this.glow.scale.set(n,n,n)}},onHit:function(t){}})},function(t,e){ABLAST.registerBullet("enemy-fat",{components:{bullet:{name:"enemy-fat",maxSpeed:.3,initialSpeed:.1,acceleration:.04,destroyable:!0,color:"#8762FF"},"collision-helper":{debug:!1,radius:.5},"json-model":{src:"#enemyBullet"}},poolSize:10},{init:function(){var t=this.el,e=this.bullet.components.bullet.color;t.setAttribute("material","color",e),t.setAttribute("scale",{x:.5,y:.5,z:.5}),this.trail=null,this.glow=null;var i=this;t.addEventListener("model-loaded",function(t){t.detail.model.children[0].material.color.setStyle(e),i.trail=i.el.getObject3D("mesh").getObjectByName("trail"),i.trail.scale.setY(.001),i.glow=i.el.getObject3D("mesh").getObjectByName("glow")})},reset:function(){var t=this.el;t.setAttribute("scale",{x:.5,y:.5,z:.5}),this.trail&&this.trail.scale.setY(.001)},tick:function(t,e){if(this.trail&&this.trail.scale.y<.1){var i=this.trail.scale.y+e/1e3;i>.1&&(i=.1),this.trail.scale.setY(i)}if(this.glow){var n=1+Math.abs(.4*Math.sin(t/80));this.glow.scale.set(n,n,n)}},onHit:function(t){}})},function(t,e){ABLAST.registerEnemy("enemy_start",{components:{enemy:{name:"enemy_start",color:"#FFB911",scale:.9,health:1},"collision-helper":{debug:!1,radius:.4},"json-model":{src:"url(assets/models/enemy0.json)",texturePath:"url(assets/images/)",singleModel:!0}},poolSize:1},{init:function(){this.shootingDelay=3e3,this.warmUpTime=1e3,this.reset()},reset:function(){var t=this.el,e=this.data.scale;t.addEventListener("model-loaded",function(i){t.getObject3D("mesh").scale.set(e,e,e)}),this.lastShoot=void 0,this.willShootEmited=!1},tick:function(t,e){this.el.components.enemy.willShoot(t,e,this.warmUpTime)},onHit:function(t){}})},function(t,e){ABLAST.registerEnemy("enemy0",{components:{enemy:{name:"enemy0",bulletName:"enemy-slow",color:"#FFB911",scale:.9,health:1},"collision-helper":{debug:!1,radius:.4},"json-model":{src:"#enemy0",texturePath:"url(assets/images/)",singleModel:!0}},poolSize:10},{init:function(){this.shootingDelay=3e3,this.warmUpTime=1e3,this.reset()},reset:function(){var t=this.el,e=this.data.scale;this.actualShootingDelay=this.shootingDelay+Math.floor(this.shootingDelay*Math.random()),t.addEventListener("model-loaded",function(i){t.getObject3D("mesh").scale.set(e,e,e)}),this.lastShoot=void 0,this.willShootEmited=!1},tick:function(t,e){if(void 0==this.lastShoot)this.lastShoot=t;else if(t-this.lastShoot>this.actualShootingDelay){var i=this.el.getAttribute("position");i.z<0&&i.y>0&&(this.el.components.enemy.shoot(t,e),this.lastShoot=t,this.willShootEmited=!1,this.actualShootingDelay=this.shootingDelay*(Math.random()<.7?2:1))}else!this.willShootEmited&&t-this.lastShoot>this.actualShootingDelay-this.warmUpTime&&(this.el.components.enemy.willShoot(t,e,this.warmUpTime),this.willShootEmited=!0)},onHit:function(t){}})},function(t,e){ABLAST.registerEnemy("enemy1",{components:{enemy:{name:"enemy1",bulletName:"enemy-fast",color:"#FF7D00",scale:.6,health:1},"collision-helper":{debug:!1,radius:.3},"json-model":{src:"#enemy1",texturePath:"url(assets/images/)",singleModel:!0}},poolSize:10},{init:function(){this.shootingDelay=5e3,this.warmUpTime=1e3,this.reset()},reset:function(){var t=this.el,e=this.data.scale;this.actualShootingDelay=this.shootingDelay+Math.floor(this.shootingDelay*Math.random()),t.addEventListener("model-loaded",function(i){t.getObject3D("mesh").scale.set(e,e,e)}),this.lastShoot=void 0,this.willShootEmited=!1},tick:function(t,e){if(void 0==this.lastShoot)this.lastShoot=t;else if(t-this.lastShoot>this.actualShootingDelay){var i=this.el.getAttribute("position");i.z<0&&i.y>0&&(this.el.components.enemy.shoot(t,e),this.lastShoot=t,this.willShootEmited=!1,this.actualShootingDelay=this.shootingDelay*(Math.random()<.5?2:1))}else!this.willShootEmited&&t-this.lastShoot>this.actualShootingDelay-this.warmUpTime&&(this.el.components.enemy.willShoot(t,e,this.warmUpTime),this.willShootEmited=!0)},onHit:function(t){}})},function(t,e){ABLAST.registerEnemy("enemy2",{components:{enemy:{name:"enemy2",bulletName:"enemy-medium",color:"#FF5533",scale:1.3,health:3},"collision-helper":{debug:!1,radius:.6},"json-model":{src:"#enemy2",texturePath:"url(assets/images/)",singleModel:!0}},poolSize:10},{init:function(){this.shootingDelay=2e3,this.warmUpTime=800,this.reset()},reset:function(){var t=this.el,e=this.data.scale;this.actualShootingDelay=this.shootingDelay+Math.floor(this.shootingDelay*Math.random()),t.addEventListener("model-loaded",function(i){t.getObject3D("mesh").scale.set(e,e,e)}),this.lastShoot=void 0,this.willShootEmited=!1},tick:function(t,e){if(void 0==this.lastShoot)this.lastShoot=t;else if(t-this.lastShoot>this.actualShootingDelay){var i=this.el.getAttribute("position");i.z<0&&i.y>0&&(this.el.components.enemy.shoot(t,e),this.lastShoot=t,this.willShootEmited=!1,this.actualShootingDelay=this.shootingDelay*(Math.random()<.2?2:1))}else!this.willShootEmited&&t-this.lastShoot>this.actualShootingDelay-this.warmUpTime&&(this.el.components.enemy.willShoot(t,e,this.warmUpTime),this.willShootEmited=!0)},onHit:function(t){}})},function(t,e){ABLAST.registerEnemy("enemy3",{components:{enemy:{name:"enemy3",bulletName:"enemy-fat",color:"#8762FF",scale:2.5,health:30},"collision-helper":{debug:!1,radius:1.2},"json-model":{src:"#enemy3",texturePath:"url(assets/images/)",singleModel:!0}},poolSize:4},{init:function(){this.shootingDelay=800,this.warmUpTime=500,this.reset()},reset:function(){var t=this.el,e=this.data.scale;this.actualShootingDelay=this.shootingDelay+Math.floor(this.shootingDelay*Math.random()),t.addEventListener("model-loaded",function(i){t.getObject3D("mesh").scale.set(e,e,e)}),this.lastShoot=void 0,this.willShootEmited=!1},tick:function(t,e){if(void 0==this.lastShoot)this.lastShoot=t;else if(t-this.lastShoot>this.actualShootingDelay){var i=this.el.getAttribute("position");i.z<0&&i.y>0&&(this.el.components.enemy.shoot(t,e),this.lastShoot=t,this.willShootEmited=!1,this.actualShootingDelay=this.shootingDelay*(Math.random()<.3?2:1))}else!this.willShootEmited&&t-this.lastShoot>this.actualShootingDelay-this.warmUpTime&&(this.el.components.enemy.willShoot(t,e,this.warmUpTime),this.willShootEmited=!0)},onHit:function(t){}})},function(t,e){function i(t){var e="";return t.sort(function(t,e){return parseInt(t.points)<=parseInt(e.points)}).forEach(function(t){name=t.name.toLowerCase();for(var t=t.points.toString(),i=10;i<=100;i*=10)t<i&&(t="0"+t);e+=t.pad(7)+name+"\n"}),e}AFRAME.registerSystem("highscores",{schema:{maxScores:{default:10}},init:function(){if(!this.isHighScore())return void console.warn("Highscore can't be loaded or saved as no localStorage support found!");if(this.scores=[],localStorage.highscores)this.scores=JSON.parse(localStorage.highscores);else for(var t=0;t<5;t++)this.scores[t]={name:"nobody",points:10*t,shoots:0,time:0,validShoot:0};var e=this,i=document.getElementById("ablast-ui");document.getElementById("save-score").addEventListener("click",function(t){ABLAST.currentScore.name=document.getElementById("player-name").value,e.addNewScore(ABLAST.currentScore),i.style.display="none"}),this.sceneEl.addEventListener("gamestate-changed",function(t){"state"in t.detail.diff&&("STATE_GAME_OVER"!==t.detail.state.state&&"STATE_GAME_WIN"!==t.detail.state.state||(i.style.display=e.isHighScore(ABLAST.currentScore)?"block":"none"))})},isHighScore:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}},shouldStoreScore:function(t){return this.scores.length<this.data.maxScores||this.scores[this.scores.length-1].points<t.points},addNewScore:function(t){return!!this.shouldStoreScore(t)&&(this.scores.push(t),this.scores.sort(function(t,e){return parseInt(t.points)<=parseInt(e.points)}),this.scores.length>this.data.maxScores&&this.scores.pop(),localStorage.highscores=JSON.stringify(this.scores),this.sceneEl.emit("highscores-updated",this.scores),!0)}}),AFRAME.registerComponent("highscores",{schema:{},init:function(){var t=this.el,e=this,n=this.el.sceneEl;n.addEventListener("highscores-updated",function(n){t.setAttribute("bmfont-text",{text:i(e.system.scores)})}),t.setAttribute("bmfont-text",{fntImage:"assets/fonts/mozillavr.png",fnt:"assets/fonts/mozillavr.fnt",scale:.0015,baseline:"top",lineHeight:90,text:i(this.system.scores),color:"#24caff"})}})},function(t,e){AFRAME.registerComponent("proxy_event",{schema:{event:{default:""},dst:{type:"selector"},bubbles:{default:!1}},init:function(){this.el.sceneEl.addEventListener(this.data.event,function(t){this.data.dst.emit(this.data.event,t,this.data.bubbles)}.bind(this))}})},function(t,e){AFRAME.registerComponent("countdown",{schema:{start:{default:"01:00"},value:{default:"00:00"},autostart:{default:!1}},init:function(){this.timeinterval=null,this.data.autostart&&this.restart();var t=this;this.el.sceneEl.addEventListener("gamestate-changed",function(e){if("state"in e.detail.diff)switch(e.detail.state.state){case"STATE_PLAYING":t.restart();break;case"STATE_GAME_OVER":case"STATE_GAME_WIN":case"STATE_MAIN_MENU":t.stop()}})},initializeClock:function(t){function e(){var e=Date.parse(t)-Date.parse(new Date),n=Math.floor(e/1e3%60),s=Math.floor(e/1e3/60%60),o={total:e,minutes:s,seconds:n};i.el.sceneEl.emit("countdown-update",o),o.total<=0&&(clearInterval(i.timeinterval),i.el.sceneEl.emit("countdown-end"))}var i=this;this.el.sceneEl.emit("countdown-start",t),this.timeinterval=setInterval(e,1e3),e()},stop:function(){clearInterval(this.timeinterval),this.el.sceneEl.emit("countdown-update",{total:0,minutes:0,seconds:0})},restart:function(){this.stop();var t=this.data.start.split(":").map(function(t){return parseInt(t)}),e=new Date(Date.parse(new Date)+1e3*(60*t[0]+t[1]));this.initializeClock(e)}})},function(t,e){AFRAME.registerSystem("decals",{schema:{size:{default:.1},src:{default:"",type:"asset"},maxDecals:{default:30}},init:function(){this.numDecals=0,this.decals=[],this.oldestDecalIdx=0,this.textureSrc=null,this.geometry=new THREE.PlaneGeometry(1,1),this.material=new THREE.MeshBasicMaterial({transparent:!0,color:"#24CAFF",depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-20}),this.updateMap()},updateMap:function(){function t(t){this.material.map=t,this.material.needsUpdate=!0}var e=this.data.src;if(e){if(e===this.textureSrc)return;return this.textureSrc=e,void this.sceneEl.systems.material.loadTexture(e,{src:e},t.bind(this))}this.material.map&&t(null)},update:function(t){this.updateMap()},getDecal:function(){var t=this.data.maxDecals,e=this.data.size,i=null;return 0===t||this.numDecals<t?(i=new THREE.Mesh(this.geometry,this.material),this.numDecals++,this.decals.push(i)):(i=this.decals[this.oldestDecalIdx],this.oldestDecalIdx=(this.oldestDecalIdx+1)%this.data.maxDecals),i.scale.set(e,e,e),i},addDecal:function(t,e){var i=this.getDecal();i&&(i.position.set(0,0,0),i.position.copy(t),i.lookAt(e),i.rotation.z+=Math.random()*Math.PI*2,this.sceneEl.object3D.add(i))}})},function(t,e){function i(t){return.5*(1-Math.cos(Math.PI*t))}function n(t){function e(t,e,i,n,s,o,a){var r=.5*(i-t),l=.5*(n-e);return(2*(e-i)+r+l)*a+(-3*(e-i)-2*r-l)*o+r*s+e}var i=new THREE.Spline(t);return i.getPointFrom=function(t,i){var n,s,o,a,r,l,h,c,u,d,m;return l=this.points,h=i+t,n=[],n[0]=0===i?i:i-1,n[1]=i,n[2]=i>l.length-2?l.length-1:i+1,n[3]=i>l.length-3?l.length-1:i+2,s=l[n[0]],o=l[n[1]],a=l[n[2]],r=l[n[3]],m=h-i,c=m*m,u=m*c,d={},d.x=e(s.x,o.x,a.x,r.x,m,c,u),d.y=e(s.y,o.y,a.y,r.y,m,c,u),d.z=e(s.z,o.z,a.z,r.z,m,c,u),d},i.getPointFrom=i.getPointFrom.bind(i),i}THREE.Spline=function(t){function e(t,e,i,n,s,o,a){var r=.5*(i-t),l=.5*(n-e);return(2*(e-i)+r+l)*a+(-3*(e-i)-2*r-l)*o+r*s+e}this.points=t;var i,n,s,o,a,r,l,h,c,u=[],d={x:0,y:0,z:0};this.initFromArray=function(t){this.points=[];for(var e=0;e<t.length;e++)this.points[e]={x:t[e][0],y:t[e][1],z:t[e][2]}},this.getPoint=function(t){return i=(this.points.length-1)*t,n=Math.floor(i),s=i-n,u[0]=0===n?n:n-1,u[1]=n,u[2]=n>this.points.length-2?this.points.length-1:n+1,u[3]=n>this.points.length-3?this.points.length-1:n+2,r=this.points[u[0]],l=this.points[u[1]],h=this.points[u[2]],c=this.points[u[3]],o=s*s,a=s*o,d.x=e(r.x,l.x,h.x,c.x,s,o,a),d.y=e(r.y,l.y,h.y,c.y,s,o,a),d.z=e(r.z,l.z,h.z,c.z,s,o,a),d},this.getControlPointsArray=function(){var t,e,i=this.points.length,n=[];for(t=0;t<i;t++)e=this.points[t],n[t]=[e.x,e.y,e.z];return n},this.getLength=function(t){var e,i,n,s,o=0,a=0,r=0,l=new THREE.Vector3,h=new THREE.Vector3,c=[],u=0;for(c[0]=0,t||(t=100),n=this.points.length*t,l.copy(this.points[0]),e=1;e<n;e++)i=e/n,s=this.getPoint(i),h.copy(s),u+=h.distanceTo(l),l.copy(s),o=(this.points.length-1)*i,a=Math.floor(o),a!==r&&(c[a]=u,r=a);return c[c.length]=u,{chunks:c,total:u}},this.reparametrizeByArcLength=function(t){var e,i,n,s,o,a,r,l,h=[],c=new Vector3,u=this.getLength();for(h.push(c.copy(this.points[0]).clone()),e=1;e<this.points.length;e++){for(a=u.chunks[e]-u.chunks[e-1],r=Math.ceil(t*a/u.total),s=(e-1)/(this.points.length-1),o=e/(this.points.length-1),i=1;i<r-1;i++)n=s+i*(1/r)*(o-s),l=this.getPoint(n),h.push(c.copy(l).clone());h.push(c.copy(this.points[e]).clone())}this.points=h}},AFRAME.registerComponent("curve-movement",{schema:{debug:{default:!1},type:{default:"single"},restTime:{default:150},speed:{default:3},loopStart:{default:1},timeOffset:{default:0}},init:function(){this.direction=1},isClosed:function(){return"loop"===this.data.type},addPoints:function(t){var e,i,s=this.data;"loop"===s.type&&(t=t.slice(0),t.push(t[this.data.loopStart])),e=this.spline=n(),e.initFromArray(t),this.currentPointIndex=0,i=e.getLength().chunks,this.cycleTimes=i.map(function(t,e){return 0===e?null:(t-i[e-1])/s.speed*1e3}).filter(function(t){return null!==t}),this.time=this.data.timeOffset,this.initTime=null,this.restTime=0,this.direction=1,this.end=!1},update:function(){var t=this.data,e=this.el;t.debug?e.setAttribute("spline-line",{pointer:"movement-pattern.movementPattern.spline"}):e.removeAttribute("spline-line")},play:function(){this.time=this.data.timeOffset,this.initTime=null},tick:function(t,e){var n,s,o,a=this.data,r=this.el,l=this.spline;if(this.initTime||(this.initTime=t),!this.end&&(this.isClosed()||this.currentPointIndex!==l.points.length-1)){n=this.cycleTimes[this.currentPointIndex];var h=0,c=!1;if(this.time>n?(h=1,c=!0):h=this.time/n,this.direction===-1&&(h=1-h),s="single"===a.type?i(h):h,this.time=t-this.initTime,this.time<0)return void console.log(s);o=l.getPointFrom(s,this.currentPointIndex),r.setAttribute("position",{x:o.x,y:o.y,z:o.z}),this.lastPercent=s,c&&(1===this.direction?this.currentPointIndex===l.points.length-2?"single"===a.type?this.end=!0:"loop"===a.type?this.currentPointIndex=this.data.loopStart:this.direction=-1:this.currentPointIndex++:(this.currentPointIndex--,this.currentPointIndex<this.data.loopStart&&(this.currentPointIndex=this.data.loopStart,this.direction=1)),this.initTime=t,this.time=0)}}})},function(t,e){AFRAME.registerComponent("collision-helper",{schema:{type:{default:"sphere",oneOf:["sphere","box"]},radius:{default:1,if:{type:["sphere"]}},debug:{default:!1},color:{type:"color",default:8947848}},init:function(){var t=this.data;this.geometry=new THREE.IcosahedronGeometry(1,1),this.material=new THREE.MeshBasicMaterial({color:t.color,wireframe:!0}),this.helperMesh=null,t.debug&&this.createHelperMesh()},createHelperMesh:function(){var t=this.data.radius;this.helperMesh=new THREE.Mesh(this.geometry,this.material),this.helperMesh.visible=!0,this.helperMesh.scale.set(t,t,t),this.el.setObject3D("collision-helper-mesh",this.helperMesh)},update:function(t){var e=this.data;e.debug&&(this.helperMesh?(this.material.color.set(e.color),this.helperMesh.scale.set(e.radius,e.radius,e.radius),this.helperMesh.visible=e.debug):this.createHelperMesh())}})},function(t,e){ABLAST.currentScore={name:"",points:0,time:0,shoots:0,validShoot:0},AFRAME.registerComponent("gamestate",{schema:{health:{default:5},numEnemies:{default:0},numSequences:{default:0},points:{default:0},numEnemiesToWin:{default:100},isGameOver:{default:!1},isGameWin:{default:!1},state:{default:"STATE_MAIN_MENU",oneOf:["STATE_MAIN_MENU","STATE_PLAYING","STATE_GAME_OVER","STATE_GAME_WIN"]},wave:{default:0},waveSequence:{default:0}},gameEnd:function(t,e){t.state="STATE_GAME_WIN",t.isGameWin=!0,document.getElementById("introMusic").components.sound.playSound(),document.getElementById("mainThemeMusic").components.sound.pauseSound()},init:function(){function t(t,i){n.addEventListener(t,function(n){var s=i(AFRAME.utils.extend({},o),n);e(t,s)})}function e(t,e){var i=AFRAME.utils.extend({},o);n.setAttribute("gamestate",e),o=e,n.emit("gamestate-changed",{event:t,diff:AFRAME.utils.diff(i,e),state:e})}var i=this,n=this.el,s=this.initialState,o=this.data;s||(s=o),n.emit("gamestate-initialized",{state:s}),t("enemy-death",function(t){return t.points++,ABLAST.currentScore.points++,t.points>=i.data.numEnemiesToWin&&i.gameEnd(t,!0),t.numEnemies--,0===t.numEnemies&&(t.numSequences--,t.waveSequence++,0===t.numSequences&&(t.waveSequence=0,t.wave++,t.wave>=WAVES.length&&i.gameEnd(t,!0))),t}),t("wave-created",function(t,e){var i=e.detail.wave;return t.numSequences=i.sequences.length,t.waveSequence=0,t}),t("enemy-spawn",function(t){return t.numEnemies++,t}),t("start-game",function(t){return t.isGameOver=!1,t.isGameWin=!1,t.state="STATE_PLAYING",t}),t("player-hit",function(t){return"STATE_PLAYING"===t.state&&(t.health-=1,t.health<=0&&(t.isGameOver=!0,t.numEnemies=0,t.state="STATE_GAME_OVER",document.getElementById("introMusic").components.sound.playSound(),document.getElementById("mainThemeMusic").components.sound.pauseSound())),t}),t("reset",function(){return ABLAST.currentScore={name:"",points:0,time:0,shoots:0,validShoot:0},s})}}),AFRAME.registerComponent("gamestate-bind",{schema:{default:{},parse:AFRAME.utils.styleParser.parse},update:function(){var t=this.el.closestScene();t.hasLoaded&&this.updateBinders(),t.addEventListener("loaded",this.updateBinders.bind(this))},updateBinders:function(){function t(t){Object.keys(t).forEach(function(s){var o=e[s],a=t[s];n.indexOf(s)!==-1&&AFRAME.utils.entity.setComponentProperty(i,o,a)})}var e=this.data,i=this.el,n=Object.keys(this.data);i.sceneEl.addEventListener("gamestate-changed",function(e){t(e.detail.diff)}),i.sceneEl.addEventListener("gamestate-initialized",function(e){t(e.detail.state)})}})},function(t,e){function i(t){var e="DEBUG\n";return Object.keys(t).sort().forEach(function(i){e+=i+": "+t[i]+"\n"}),e}AFRAME.registerComponent("gamestate-debug",{init:function(){function t(t){e.setAttribute("bmfont-text",{text:i(t.detail.state),color:"#DADADA"})}var e=this.el,n=this.el.sceneEl;n.addEventListener("gamestate-initialized",t),n.addEventListener("gamestate-changed",t)}})},function(t,e){AFRAME.registerComponent("shoot-controls",{schema:{hand:{default:"left"}},init:function(){var t=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){t.onButtonEvent(e.detail.id,"down")},this.onButtonUp=function(e){t.onButtonEvent(e.detail.id,"up")}},play:function(){var t=this.el;t.addEventListener("buttonchanged",this.onButtonChanged),t.addEventListener("buttondown",this.onButtonDown),t.addEventListener("buttonup",this.onButtonUp)},pause:function(){var t=this.el;t.removeEventListener("buttonchanged",this.onButtonChanged),t.removeEventListener("buttondown",this.onButtonDown),t.removeEventListener("buttonup",this.onButtonUp)},mapping:{axis0:"trackpad",axis1:"trackpad",button0:"trackpad",button1:"trigger",button2:"grip",button3:"menu",button4:"system"},onButtonChanged:function(t){var e=this.mapping["button"+t.detail.id];if("trigger"===e){var i=t.detail.state.value;this.el.components.weapon.setTriggerPressure(i)}},onButtonEvent:function(t,e){var i=this.mapping["button"+t];this.el.emit(i+e)},update:function(){var t=this.data,e=this.el;e.setAttribute("vive-controls",{hand:t.hand,model:!1}),e.setAttribute("oculus-touch-controls",{hand:t.hand,model:!1}),e.setAttribute("windows-motion-controls",{hand:t.hand,model:!1}),"right"===t.hand&&(e.setAttribute("daydream-controls",{hand:t.hand,model:!1}),e.setAttribute("gearvr-controls",{hand:t.hand,model:!1}))}})},function(t,e){AFRAME.registerComponent("bullet",{schema:{name:{default:""},direction:{type:"vec3"},maxSpeed:{default:5},initialSpeed:{default:5},position:{type:"vec3"},acceleration:{default:.5},destroyable:{default:!1},owner:{default:"player",oneOf:["enemy","player"]},color:{default:"#fff"
}},init:function(){this.startEnemy=document.getElementById("start_enemy"),this.backgroundEl=document.getElementById("border"),this.bullet=ABLAST.BULLETS[this.data.name],this.bullet.definition.init.call(this),this.hit=!1,this.direction=new THREE.Vector3,this.temps={direction:new THREE.Vector3,position:new THREE.Vector3}},update:function(t){var e=this.data;this.owner=this.data.owner,this.direction.set(e.direction.x,e.direction.y,e.direction.z),this.currentAcceleration=e.acceleration,this.speed=e.initialSpeed,this.startPosition=e.position},play:function(){this.initTime=null},hitObject:function(t,e){if(this.bullet.definition.onHit.call(this),this.hit=!0,"enemy"===this.data.owner)this.el.emit("player-hit"),document.getElementById("hurtSound").components.sound.playSound();else if("bullet"===t)e.components.bullet.resetBullet(),this.el.sceneEl.systems.explosion.createExplosion(t,e.object3D.position,e.getAttribute("bullet").color,1,this.direction),ABLAST.currentScore.validShoot++;else if("background"===t){this.el.sceneEl.systems.decals.addDecal(e.point,e.face.normal);var i=e.point.clone().sub(this.direction.clone().multiplyScalar(.2));this.el.sceneEl.systems.explosion.createExplosion(t,i,"#fff",1,this.direction)}else if("enemy"===t){var n=e.getAttribute("enemy");e.components.enemy.health<=0?this.el.sceneEl.systems.explosion.createExplosion("enemy",e.object3D.position,n.color,n.scale,this.direction,n.name):this.el.sceneEl.systems.explosion.createExplosion("bullet",this.el.object3D.position,n.color,n.scale,this.direction),ABLAST.currentScore.validShoot++}this.resetBullet()},resetBullet:function(){this.hit=!1,this.bullet.definition.reset.call(this),this.initTime=null,this.direction.set(this.data.direction.x,this.data.direction.y,this.data.direction.z),this.currentAcceleration=this.data.acceleration,this.speed=this.data.initialSpeed,this.startPosition=this.data.position,this.system.returnBullet(this.data.name,this.el)},tick:function(){return function(t,e){this.initTime||(this.initTime=t),this.bullet.definition.tick.call(this,t,e),this.el.object3D.lookAt(this.direction.clone().multiplyScalar(1e3)),this.temps.position.copy(this.el.getAttribute("position")),this.speed=.1*this.currentAcceleration*e,this.speed>this.data.maxSpeed&&(this.speed=this.data.maxSpeed),this.temps.direction.copy(this.direction);var i=this.temps.position.add(this.temps.direction.multiplyScalar(this.speed));if(this.el.setAttribute("position",i),this.temps.position.length()>=50)return void this.resetBullet();var n=this.el.getAttribute("collision-helper");if(n){var s=n.radius;if("player"===this.data.owner){if("player"===this.data.owner){var o=this.el.sceneEl.getAttribute("gamestate").state;if("STATE_MAIN_MENU"===o){var a=this.startEnemy,r=a.getAttribute("collision-helper"),l=r.radius;if(i.distanceTo(a.object3D.position)<l+s)return this.el.sceneEl.systems.explosion.createExplosion("enemy",this.el.getAttribute("position"),"#ffb911",.5,this.direction,"enemy_start"),a.emit("hit"),document.getElementById("introMusic").components.sound.pauseSound(),void document.getElementById("mainThemeMusic").components.sound.playSound()}else if("STATE_GAME_WIN"===o||"STATE_GAME_OVER"===o){var a=document.getElementById("reset"),r=a.getAttribute("collision-helper"),l=r.radius;if(i.distanceTo(a.object3D.position)<2*l+2*s)return this.el.sceneEl.systems.explosion.createExplosion("enemy",this.el.getAttribute("position"),"#f00",.5,this.direction,"enemy_start"),void this.el.sceneEl.emit("reset")}else for(var h=this.el.sceneEl.systems.enemy.activeEnemies,c=0;c<h.length;c++){var a=h[c],r=a.getAttribute("collision-helper");if(r){var l=r.radius;if(i.distanceTo(a.object3D.position)<l+s)return a.emit("hit"),void this.hitObject("enemy",a)}}for(var u=this.system.activeBullets,c=0;c<u.length;c++){var d=u[c],m=d.components.bullet.data;if(m&&"player"!==m.owner&&m.destroyable){var p=d.components["collision-helper"];if(p){var f=p.data.radius;if(i.distanceTo(d.getAttribute("position"))<f+s)return void this.hitObject("bullet",d)}}}}}else{var g=this.el.sceneEl.camera.el.components["look-controls"].dolly.position;if(i.distanceTo(g)<.1+s)return void this.hitObject("player")}var E=new THREE.Raycaster(this.temps.position,this.temps.direction.clone().normalize()),y=this.backgroundEl.getObject3D("mesh");if(y){var v=E.intersectObjects(y.children,!0),b=this;v.forEach(function(t){if(t.distance<b.temps.position.length()){if(!t.object.el)return;return void b.hitObject("background",t)}})}}}}()})},function(t,e,i){var n=i(28);AFRAME.registerComponent("lifes-counter",{schema:{width:{default:.9},value:{default:"      "},numSegments:{default:6},height:{default:.2},color:{default:16711680}},init:function(){this.letterPanel=new n(this.el.sceneEl.systems.material,this.data),this.el.setObject3D("mesh",this.letterPanel.group)},update:function(){var t=this.data.value,e=[0,0,0,0,0].map(function(e,i){return i>=t?" ":"*"}).reverse().join("");this.letterPanel.update(e)}})},function(t,e){function i(t,e){function i(t){this.material.map=t,this.material.needsUpdate=!0}this.width=e.width,this.height=e.height,this.numSegments=e.numSegments;var s="assets/images/font.png";t.loadTexture(s,{src:s},i.bind(this)),this.material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,color:e.color,transparent:!0}),this.group=new THREE.Group;var o=this.width/this.numSegments;this.numLetters=n.length;for(var a=0;a<this.numSegments;a++)plane=new THREE.Mesh(new THREE.PlaneBufferGeometry(o,this.height),this.material),plane.position.x=a*o,this.group.add(plane)}var n="0123456789:* ";i.prototype={update:function(t){t=t.split("").map(function(t){return n.indexOf(t)});for(var e=1/this.numLetters,i=0;i<this.numSegments;i++){var s=this.group.children[i].geometry.attributes.uv,o=s.array,a=t[i]*e,r=(t[i]+1)*e;o[0]=a,o[4]=a,o[2]=r,o[6]=r,s.needsUpdate=!0}}},t.exports=i},function(t,e,i){var n=i(28);AFRAME.registerComponent("points-counter",{schema:{value:{default:0},height:{default:.7},numSegments:{default:3},width:{default:.9},color:{default:2411263}},init:function(){this.letterPanel=new n(this.el.sceneEl.systems.material,this.data),this.el.setObject3D("mesh",this.letterPanel.group),this.el.sceneEl.addEventListener("enemy-death",function(){})},update:function(){this.letterPanel.update(this.data.value.padLeft(3))}})},function(t,e,i){var n=i(28);AFRAME.registerComponent("timer-counter",{schema:{width:{default:.9},value:{default:""},numSegments:{default:5},height:{default:.35},color:{default:2411263}},init:function(){this.letterPanel=new n(this.el.sceneEl.systems.material,this.data),this.el.setObject3D("mesh",this.letterPanel.group);var t=this;this.el.sceneEl.addEventListener("countdown-update",function(e){var i=e.detail,n=i.minutes.padLeft(2)+":"+i.seconds.padLeft(2);t.letterPanel.material.color.set(i.total<=1e4?16711680:2411263),t.el.setAttribute("timer-counter",{value:n})})},update:function(){this.letterPanel.update(this.data.value)}})},function(t,e){AFRAME.registerComponent("enemy",{schema:{name:{default:"enemy0"},bulletName:{default:"enemy-slow"},shootingDelay:{default:200},health:{default:1},color:{default:"#fff"},scale:{default:1},canShoot:{default:!0}},init:function(){function t(t){this.gunGlowMaterial.alphaMap=t,this.gunGlowMaterial.needsUpdate=!0,this.gunGlowMaterial.visible=!0}this.alive=!0,this.hipBone=null,this.definition=ABLAST.ENEMIES[this.data.name].definition,this.definition.init.call(this);var e=ABLAST.ENEMIES[this.data.name].components.enemy;this.maxhealth=this.health=e.health,this.color=e.color,this.scale=e.scale,this.gunOffset=new THREE.Vector3(0,.44,.5).multiplyScalar(this.scale),this.lastShootTime=void 0,this.shootAt=0,this.warmUpTime=1e3,this.paused=!1;var i=this;this.el.addEventListener("model-loaded",function(t){i.el.components["json-model"].playAnimation("fly",!0),i.hipBone=i.el.object3D.children[3].children[0]}),this.gunGlowMaterial=new THREE.MeshBasicMaterial({color:this.color,side:THREE.DoubleSide,transparent:!0,blending:THREE.AdditiveBlending,depthTest:!0,depthWrite:!1,visible:!1});var n=document.querySelector("#fx3").getAttribute("src");this.el.sceneEl.systems.material.loadTexture(n,{src:n},t.bind(this)),this.gunGlow=new THREE.Mesh(new THREE.PlaneGeometry(this.scale,this.scale),this.gunGlowMaterial),this.gunGlow.position.copy(this.gunOffset),this.el.setObject3D("glow",this.gunGlow),this.exploding=!1,this.explodingDuration=500+Math.floor(300*Math.random()),this.el.addEventListener("hit",this.collided.bind(this)),this.sounds=[document.getElementById("explosion0"),document.getElementById("explosion1"),document.getElementById("explosion2")]},update:function(t){},play:function(){this.paused=!1},pause:function(){this.paused=!0},collided:function(){if(!this.exploding&&(this.health--,this.health<=0)){this.el.emit("enemy-hit"),this.exploding=!0;var t=this.el.getObject3D("mesh");this.whiteMaterial=new THREE.MeshBasicMaterial({color:this.color,transparent:!0}),t.normalMaterial=t.material,t.material=this.whiteMaterial,this.gunGlow.visible=!1,this.system.activeEnemies.splice(this.system.activeEnemies.indexOf(this.el),1)}},die:function(){this.alive=!1,this.reset(),this.system.onEnemyDeath(this.data.name,this.el)},reset:function(){var t=this.el.getObject3D("mesh");t&&(t.material.opacity=1,t.scale.set(this.scale,this.scale,this.scale),t.material=t.normalMaterial,this.gunGlow.visible=!0,this.gunGlow.scale.set(1,1,1),this.gunGlowMaterial.opacity=.3),this.el.setAttribute("scale","1 1 1"),this.explodingTime=void 0,this.lastShootTime=void 0,this.shootAt=0,this.warmUpTime=1e3,this.health=this.maxhealth,this.alive=!0,this.exploding=!1,this.definition.reset.call(this)},shoot:function(t,e){var i=this.el;if(i){var n=this.data,s=i.object3D,o=s.localToWorld(this.gunGlow.position.clone()),a=i.sceneEl.camera.el.components["look-controls"].dolly.position.clone(),r=a.sub(s.position).normalize();this.lastShootTime=t,this.gunGlow.scale.set(3,3,3),this.gunGlowMaterial.opacity=1,this.el.sceneEl.systems.explosion.createExplosion("enemygun",o,this.color,this.scale,r,this.data.name);var l=i.sceneEl.systems.bullet.getBullet(n.bulletName);l.setAttribute("bullet",{position:o,direction:r,owner:"enemy"}),l.setAttribute("position",o),l.setAttribute("visible",!0),l.play()}},willShoot:function(t,e,i){this.shootAt=t+i,this.warmUpTime=i},tick:function(t,e){if(this.alive&&!this.paused)if(this.exploding){this.explodingTime||(this.explodingTime=t);var i=(t-this.explodingTime)/this.explodingDuration,n=this.scale+i*(2-i),s=this.el.getObject3D("mesh");s.scale.set(n,n,n),s.material.opacity=Math.max(0,1-2.5*i),i>=1&&this.die()}else{var o=700;if(void 0===this.lastShootTime)this.lastShootTime=t;else if(this.shootAt-t<this.warmUpTime){this.gunGlowMaterial.opacity=(this.shootAt-t)/this.warmUpTime;var a=1+Math.abs(Math.sin(t/50));this.gunGlow.scale.set(a,a,a)}else t-this.lastShootTime<o&&(this.gunGlowMaterial.opacity=1-(t-this.lastShootTime)/o);this.gunGlow.position.copy(this.gunOffset),this.hipBone&&(this.gunGlow.position.y+=this.hipBone.position.y);var r=this.el.sceneEl.camera.el.components["look-controls"].dolly.position.clone();this.el.object3D.lookAt(r),this.definition.tick.call(this,t,e)}}})},function(t,e){var i={default:{model:{url:"url(assets/models/gun.json)",positionOffset:[0,0,0],rotationOffset:[0,0,0]},shootSound:"url(assets/sounds/gun.ogg)",shootingDelay:100,bullet:"default"}};AFRAME.registerComponent("weapon",{dependencies:["shoot-controls"],schema:{enabled:{default:!0},type:{default:"default"}},updateWeapon:function(){console.log(this.controllerModel),"oculus-touch-controller"===this.controllerModel?(this.model.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(1,0,0),.8)),this.el.setAttribute("shoot",{direction:"0 -0.3 -1"})):"daydream-controls"===this.controllerModel&&(document.getElementById("rightHandPivot").setAttribute("position","-0.2 0 -0.5"),this.el.setAttribute("shoot",{on:"trackpaddown"}))},init:function(){var t=this.el,e=this;this.model=null,this.isGamepadConnected=!1,this.controllerModel=null,this.weapon=i[this.data.type],t.setAttribute("json-model",{src:this.weapon.model.url}),t.setAttribute("sound",{src:this.weapon.shootSound,on:"shoot",volume:.5,poolSize:10}),this.fires=[],this.trigger=null,t.addEventListener("controllerconnected",function(t){console.log(t),e.controllerModel=t.detail.name,null==e.model?e.isGamepadConnected=!0:e.updateWeapon()}),t.addEventListener("model-loaded",function(e){this.model=e.detail.model;var i=new THREE.Group;i.add(this.model),t.setObject3D("mesh",i);for(var n=0;n<3;n++){var s=this.model.getObjectByName("fire"+n);s&&(s.material.depthWrite=!1,s.visible=!1,this.fires.push(s))}this.isGamepadConnected&&this.updateWeapon(),this.trigger=this.model.getObjectByName("trigger")}.bind(this));var e=this;t.addEventListener("shoot",function(i){t.components["json-model"].playAnimation("default"),e.light.components.light.light.intensity=e.lightIntensity;for(var n in e.fires)e.fires[n].visible=!0,e.fires[n].life=50+100*Math.random()}),this.lightIntensity=3,this.life=this.data.lifespan,this.canShoot=!0,this.light=document.createElement("a-entity"),t.appendChild(this.light),this.light.setAttribute("light",{color:"#24CAFF",intensity:0,type:"point"}),this.light.setAttribute("position",{x:0,y:-.22,z:-.14});var e=this;this.light.addEventListener("loaded",function(){e.lightObj=e.light.components.light.light})},tick:function(t,e){if(this.lightObj&&this.lightObj.intensity>0){this.light.visible=!0,this.lightObj.intensity-=e/1e3*10,this.lightObj.intensity<0&&(this.lightObj.intensity=0,this.light.visible=!1);for(var i in this.fires)this.fires[i].visible&&(this.fires[i].life-=e,0==i?this.fires[i].rotation.set(0,Math.random()*Math.PI*2,0):this.fires[i].rotation.set(0,1*Math.random()-.5+(Math.random()>.5?Math.PI:0),0),this.fires[i].life<0&&(this.fires[i].visible=!1))}},update:function(){var t=this.data;this.weapon=i[t.type]},setTriggerPressure:function(t){this.trigger&&this.trigger.position.setY(.01814*t)}}),t.exports=i},function(t,e,i){var n=i(32);AFRAME.registerComponent("shoot",{schema:{direction:{type:"vec3",default:{x:0,y:-2,z:-1}},on:{default:"triggerdown"},spaceKeyEnabled:{default:!1},weapon:{default:"default"}},init:function(){var t=this.data,e=this.el,i=this;this.coolingDown=!1,this.shoot=this.shoot.bind(this),this.weapon=null,t.on&&e.addEventListener(t.on,this.shoot),t.spaceKeyEnabled&&window.addEventListener("keydown",function(t){"Space"!==t.code&&"32"!==t.keyCode||i.shoot()})},update:function(t){this.weapon=n[this.data.weapon],t.on!==this.data.on&&(this.el.removeEventListener(t.on,this.shoot),this.el.addEventListener(this.data.on,this.shoot))},shoot:function(){var t=new THREE.Vector3,e=new THREE.Vector3,i=new THREE.Quaternion,n=new THREE.Vector3,s=new THREE.Vector3,o=new THREE.Vector3(0,-.23,-.15),a=new THREE.Vector3(0,-.23,-.8),r=new THREE.Vector3;return function(){var l,h,c=this.el,u=this.data,d=this,m=this.weapon;this.coolingDown||(ABLAST.currentScore.shoots++,c.object3D.updateMatrixWorld(),h=c.object3D.matrixWorld,e.setFromMatrixPosition(h),h.decompose(s,i,n),t.set(u.direction.x,u.direction.y,u.direction.z),t.applyQuaternion(i),t.normalize(),c.components.weapon&&r.copy("oculus-touch-controller"===c.components.weapon.controllerModel?a:o),r.applyQuaternion(i),e.add(r),l=c.sceneEl.systems.bullet.getBullet(m.bullet),l.setAttribute("position",e),l.setAttribute("bullet",{direction:t.clone(),position:e.clone(),owner:"player"}),l.setAttribute("visible",!0),l.setAttribute("position",e),l.play(),c.emit("shoot",l),this.coolingDown=!0,setTimeout(function(){d.coolingDown=!1},m.shootingDelay))}}()})},function(t,e){AFRAME.registerComponent("headset",{schema:{on:{default:"click"}},init:function(){},tick:function(t,e){var i=this.el.getObject3D("mesh");i&&i.update(e/1e3),this.updatePose(),this.updateButtons()},updatePose:function(){var t=new THREE.Euler,e=new THREE.Vector3,i=new THREE.Quaternion,n=new THREE.Object3D,s=new THREE.Matrix4;return t.order="YXZ",function(){var o,a,r,l,h=this.el,c=this.system.vrDisplay;this.update(),o=this.controller,o&&(a=o.pose,r=a.orientation||[0,0,0,1],l=a.position||[0,0,0],i.fromArray(r),n.quaternion.fromArray(r),n.position.fromArray(l),n.updateMatrix(),c&&c.stageParameters&&(s.fromArray(c.stageParameters.sittingToStandingTransform),n.applyMatrix(s)),t.setFromRotationMatrix(n.matrix),e.setFromMatrixPosition(n.matrix),h.setAttribute("rotation",{x:THREE.Math.radToDeg(t.x),y:THREE.Math.radToDeg(t.y),z:THREE.Math.radToDeg(t.z)}),h.setAttribute("position",{x:e.x,y:e.y,z:e.z}))}}()})},function(t,e){AFRAME.registerComponent("json-model",{schema:{src:{type:"asset"},singleModel:{default:!1},texturePath:{type:"asset",default:""},debugNormals:{default:!1},debugNormalsLength:{default:.2},debugBones:{default:!1}},init:function(){},fixNormal:function(t){var e=t.y;t.y=-t.z,t.z=e},update:function(t){this.loader=null,this.helpers=new THREE.Group,this.mixers=[],this.animationNames=[],this.skeletonHelper=null;var e=this.data.src;e&&e!==t.src&&(this.data.singleModel?(this.loader=new THREE.JSONLoader,this.loader.setTexturePath(this.data.texturePath),this.loader.load(e,this.onModelLoaded.bind(this))):(this.loader=new THREE.ObjectLoader,this.loader.setCrossOrigin(""),this.loader.load(e,this.onSceneLoaded.bind(this))))},onModelLoaded:function(t,e){this.helpers=new THREE.Group;var i=new THREE.SkinnedMesh(t,e[0]),n=this;if(i.geometry.faces.forEach(function(t){t.vertexNormals.forEach(function(t){t.hasOwnProperty("fixed")||(n.fixNormal(t),t.fixed=!0)})}),void 0!==i.geometry.animations&&i.geometry.animations.length>0){i.material.skinning=!0;var s={mixer:new THREE.AnimationMixer(i),clips:{}};for(var o in i.geometry.animations){var a=i.geometry.animations[o],r=s.mixer.clipAction(a).stop();r.setEffectiveWeight(1),s.clips[a.name]=r}this.mixers.push(s)}n.addNormalHelpers(i),this.helpers.visible=this.data.debugNormals,this.el.setObject3D("helpers",this.helpers),this.skeletonHelper=new THREE.SkeletonHelper(i),this.skeletonHelper.material.linewidth=2,this.el.setObject3D("skelhelper",this.skeletonHelper),this.skeletonHelper.visible=this.data.debugBones,this.el.setObject3D("mesh",i),this.el.emit("model-loaded",{format:"json",model:i,src:this.data.src})},onSceneLoaded:function(t){if(this.helpers=new THREE.Group,void 0!==t.animations){var e={mixer:new THREE.AnimationMixer(t),clips:{}};for(var i in t.animations){var n=t.animations[i],s=e.mixer.clipAction(n).stop();e.clips[n.name]=s}this.mixers.push(e)}var o=this;t.traverse(function(t){t instanceof THREE.Mesh&&(t.geometry.faces.forEach(function(t){t.vertexNormals.forEach(function(t){t.hasOwnProperty("fixed")||(o.fixNormal(t),t.fixed=!0)})}),o.addNormalHelpers(t))}),this.helpers.visible=this.data.debugNormals,this.el.setObject3D("helpers",this.helpers),this.el.setObject3D("mesh",t),this.el.emit("model-loaded",{format:"json",model:t,src:this.data.src})},addNormalHelpers:function(t){var e=new THREE.FaceNormalsHelper(t,this.data.debugNormalsLength);this.helpers.add(e);var i=new THREE.VertexNormalsHelper(t,this.data.debugNormalsLength);this.helpers.add(i),t.geometry.normalsNeedUpdate=!0,t.geometry.verticesNeedUpdate=!0},playAnimation:function(t,e){for(var i in this.mixers){var n=this.mixers[i].clips[t];if(void 0!==n){n.stop().play();var s=0;e===!0?s=1/0:void 0==e?e=!1:"number"==typeof e?(0===e&&(e=!1),s=e):e=!1,n.setLoop(e?THREE.LoopRepeat:THREE.LoopOnce,s)}}},stopAnimation:function(){for(var t in this.mixers)for(var e in this.mixers[t].clips)this.mixers[t].clips[e].stop()},tick:function(t,e){for(var i in this.mixers)this.mixers[i].mixer.update(e/1e3)}})},function(t,e){AFRAME.registerComponent("spline-line",{schema:{pointer:{default:""},numPoints:{default:250}},init:function(){function t(){for(var t=n.pointer.split("."),e=t.shift(),i=s.components[e];t.length;){if(!i)return;i=i[t.shift()]}return i}var e,i,n=this.data,s=this.el,o=this;this.pointMeshes=[],i=t(),i?this.drawLine(i):(e=n.pointer.split(".")[0],s.addEventListener("componentchanged",function(i){i.detail.name===e&&o.drawLine(t())}))},drawLine:function(t){var e,i,n,s=this.data,o=this.el,a=this.pointMeshes;for(e=new THREE.Geometry,n=new THREE.LineBasicMaterial({color:new THREE.Color(Math.random(),Math.random(),Math.random())}),i=0;i<s.numPoints;i++){var r=t.getPoint(i/s.numPoints);e.vertices.push(new THREE.Vector3(r.x,r.y,r.z))}e.verticesNeedsUpdate=!0,t.points.forEach(function(t){var e=new THREE.SphereGeometry(.2,16,16),i=new THREE.MeshBasicMaterial({color:"#111"}),n=new THREE.Mesh(e,i);n.position.set(t.x,t.y,t.z),a.push(n),o.sceneEl.object3D.add(n)}),this.line=new THREE.Line(e,n),o.sceneEl.object3D.add(this.line)},remove:function(){var t=this.el.sceneEl.object3D;this.line&&(t.remove(this.line),this.pointMeshes.forEach(function(e){t.remove(e)}))}})},function(t,e){AFRAME.registerComponent("explosion",{schema:{type:{default:"enemy",oneOf:["enemy","bullet","background","enemygun"]},duration:{default:500},color:{type:"color",default:"#FFFFFF"},lookAt:{type:"vec3",default:null},scale:{default:1}},update:function(t){"enemy"===this.data.type?(this.materials[2].color.set(this.data.color),this.materials[4].color.set(this.data.color)):"bullet"===this.data.type?(this.data.scale*=.5,this.materials[0].color.set(this.data.color),this.materials[2].color.set(this.data.color)):"enemygun"===this.data.type?(this.materials[0].color.set(this.data.color),this.data.duration=300):"background"===this.data.type&&(this.data.duration=300);for(var e=0;e<this.meshes.children.length;e++){var i=this.meshes.children[e];i.part.billboard&&this.data.lookAt&&i.lookAt(this.data.lookAt)}this.el.setAttribute("scale",{x:this.data.scale,y:this.data.scale,z:this.data.scale})},init:function(){function t(t,e){this.materials[t].alphaMap=e,this.materials[t].needsUpdate=!0,this.materials[t].visible=!0}this.life=0,this.starttime=null,this.meshes=new THREE.Group,this.materials=[];var e=new Array("#fx1","#fx2","#fx3","#fx4","#fx8");switch(this.el.setAttribute("scale",{x:this.data.scale,y:this.data.scale,z:this.data.scale}),this.data.type){case"enemy":this.parts=[{textureIdx:2,billboard:!0,color:16777215,scale:1.5,grow:4,dispersion:0,copies:1,speed:0},{textureIdx:0,billboard:!0,color:16777215,scale:.4,grow:2,dispersion:2.5,copies:1,speed:1},{textureIdx:3,billboard:!1,color:this.data.color,scale:1,grow:6,dispersion:0,copies:1,speed:0},{textureIdx:1,billboard:!0,color:16577633,scale:.04,grow:2,dispersion:3,copies:20,speed:2},{textureIdx:3,billboard:!0,color:this.data.color,scale:.2,grow:2,dispersion:2,copies:5,speed:1}];break;case"bullet":this.parts=[{textureIdx:2,billboard:!0,color:this.data.color,scale:.5,grow:3,dispersion:0,copies:1,speed:0},{textureIdx:4,billboard:!0,color:"#24CAFF",scale:.3,grow:4,dispersion:0,copies:1,speed:0},{textureIdx:0,billboard:!0,color:this.data.color,scale:.04,grow:2,dispersion:1.5,copies:8,speed:1}];break;case"background":this.parts=[{textureIdx:4,billboard:!0,color:"#24CAFF",scale:.3,grow:3,dispersion:0,copies:1,speed:0},{textureIdx:0,billboard:!0,color:"#24CAFF",scale:.03,grow:1,dispersion:.3,copies:8,speed:1.6,noFade:!0}];break;case"enemygun":this.parts=[{textureIdx:3,billboard:!0,color:this.data.color,scale:.5,grow:3,dispersion:0,copies:1,speed:0}]}for(var i in this.parts){var n=this.parts[i];n.meshes=[];var s=new THREE.PlaneGeometry(n.scale,n.scale),o=new THREE.MeshBasicMaterial({color:n.color,side:THREE.DoubleSide,transparent:!0,blending:THREE.AdditiveBlending,depthTest:!0,depthWrite:!1,visible:!1});o.noFade=n.noFade===!0,this.materials.push(o);var a=document.querySelector(e[n.textureIdx]).getAttribute("src");this.el.sceneEl.systems.material.loadTexture(a,{src:a},t.bind(this,i));for(var r=n.dispersion/2,l=0;l<n.copies;l++){var h=new THREE.Mesh(s,o);n.billboard?this.data.lookAt&&h.lookAt(this.data.lookAt):h.rotation.set(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),n.dispersion>0&&(h.position.set(Math.random()*n.dispersion-r,Math.random()*n.dispersion-r,Math.random()*n.dispersion-r),h.speed=n.speed+Math.random()/n.dispersion),h.part=n,this.meshes.add(h),n.meshes.push(h)}}this.el.setObject3D("explosion",this.meshes)},reset:function(){this.life=0,this.starttime=null;for(var t in this.parts)for(var e=this.parts[t],i=e.dispersion/2,n=0;n<e.copies;n++){var s=e.meshes[n];e.billboard?this.data.lookAt&&s.lookAt(this.data.lookAt):s.rotation.set(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),e.dispersion>0&&(s.position.set(Math.random()*e.dispersion-i,Math.random()*e.dispersion-i,Math.random()*e.dispersion-i),s.speed=e.speed+Math.random()/e.dispersion)}this.starttime=null,this.system.returnToPool(this.data.type,this.el)},tick:function(t,e){if(null===this.starttime&&(this.starttime=t),this.life=(t-this.starttime)/this.data.duration,this.life>1)return void this.reset();for(var i=this.life*(2-this.life),n=0;n<this.meshes.children.length;n++){var s=this.meshes.children[n],o=1+i*s.part.grow;s.scale.set(o,o,o),s.part.speed>0&&s.position.multiplyScalar(1+e/1e3*s.speed)}for(var n in this.materials)this.materials[n].noFade||(this.materials[n].opacity=1-i)}})},function(t,e){AFRAME.registerComponent("animate-message",{init:function(){var t=this;this.startMsg=null,this.el.addEventListener("model-loaded",function(e){t.startMsg=t.el.getObject3D("mesh").getObjectByName("start")})},tick:function(t,e){this.startMsg&&(this.startMsg.rotation.z=-Math.PI+Math.abs(.03*Math.sin(t/200)))}})},function(t,e,i){AFRAME.TWEEN=i(40),AFRAME.registerComponent("gamestate-visuals",{schema:{},init:function(){this.logo=document.getElementById("logo"),this.startEnemy=document.getElementById("start_enemy"),this.mainMenuGroup=document.getElementById("mainmenu"),this.messageGroup=document.getElementById("message-group"),this.gameover=document.getElementById("gameover-model"),this.welldone=document.getElementById("welldone-model"),this.reset=document.getElementById("reset"),this.highscores=document.getElementById("highscores");var t=this;this.el.sceneEl.addEventListener("gamestate-changed",function(e){"state"in e.detail.diff&&("STATE_PLAYING"===e.detail.state.state?t.startPlaying():"STATE_GAME_OVER"===e.detail.state.state?t.finishPlaying("GAME_OVER"):"STATE_GAME_WIN"===e.detail.state.state?t.finishPlaying("GAME_WIN"):"STATE_MAIN_MENU"===e.detail.state.state&&t.mainMenu())}.bind(this))},startPlaying:function(){this.highscores.setAttribute("visible",!1);var t=this,e={x:0},i=new AFRAME.TWEEN.Tween(e).to({x:.6*Math.PI},1e3).onComplete(function(){t.mainMenuGroup.setAttribute("visible",!1)}).easing(AFRAME.TWEEN.Easing.Back.InOut).onUpdate(function(){t.logo.object3D.rotation.x=e.x});i.start(),this.startEnemy.setAttribute("visible",!1)},finishPlaying:function(t){var e=this,i="GAME_OVER"===t,n=document.getElementById("finished");this.highscores.setAttribute("visible",!0),this.gameover.setAttribute("visible",i),this.welldone.setAttribute("visible",!i),n.setAttribute("visible",!0),n.object3D.position.y=-5;var s={y:-5},o=new AFRAME.TWEEN.Tween(s).to({y:1},1e3).easing(AFRAME.TWEEN.Easing.Elastic.Out).onUpdate(function(){n.object3D.position.y=s.y});o.start(),this.reset.object3D.position.y=-5;var a={y:-5},r=new AFRAME.TWEEN.Tween(a).to({y:0},1e3).delay(3e3).easing(AFRAME.TWEEN.Easing.Elastic.Out).onUpdate(function(){e.reset.object3D.position.y=a.y});r.start()},mainMenu:function(){var t=this;this.startEnemy.setAttribute("position","0 -5 -4"),this.startEnemy.setAttribute("visible",!0),this.mainMenuGroup.setAttribute("visible",!0);var e={positionY:-5},i=new AFRAME.TWEEN.Tween(e).to({positionY:1.4},1e3).delay(1e3).easing(AFRAME.TWEEN.Easing.Back.InOut).onUpdate(function(){t.startEnemy.setAttribute("position",{x:0,y:e.positionY,z:-4})});i.start();var n=document.getElementById("finished");n.object3D.position.y=1;var s={y:1},o=new AFRAME.TWEEN.Tween(s).to({y:-5},1e3).easing(AFRAME.TWEEN.Easing.Elastic.In).onComplete(function(){n.setAttribute("visible",!1)}).onUpdate(function(){n.object3D.position.y=s.y});o.start(),this.logo.object3D.rotation.x=.6*Math.PI;var a={x:0},o=new AFRAME.TWEEN.Tween(a).to({x:.6*Math.PI},1e3).easing(AFRAME.TWEEN.Easing.Elastic.Out).delay(1e3).onUpdate(function(){t.logo.object3D.rotation.x=.6*Math.PI-a.x});o.start()},tick:function(t,e){AFRAME.TWEEN.update()}})},function(t,e,i){var n,s;(function(i){var o=function(){this._tweens={},this._tweensAddedDuringUpdate={}};o.prototype={getAll:function(){return Object.keys(this._tweens).map(function(t){return this._tweens[t]}.bind(this))},removeAll:function(){this._tweens={}},add:function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},remove:function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},update:function(t,e){var i=Object.keys(this._tweens);if(0===i.length)return!1;for(t=void 0!==t?t:a.now();i.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<i.length;n++)this._tweens[i[n]].update(t)===!1&&(this._tweens[i[n]]._isPlaying=!1,e||delete this._tweens[i[n]]);i=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var a=new o;a.Group=o,a._nextId=0,a.nextId=function(){return a._nextId++},"undefined"==typeof window&&"undefined"!=typeof i?a.now=function(){var t=i.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?a.now=window.performance.now.bind(window.performance):void 0!==Date.now?a.now=Date.now:a.now=function(){return(new Date).getTime()},a.Tween=function(t,e){this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=a.Easing.Linear.None,this._interpolationFunction=a.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=e||a,this._id=a.nextId()},a.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(t,e){return this._valuesEnd=t,void 0!==e&&(this._duration=e),this},start:function(t){this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==t?t:a.now(),this._startTime+=this._delayTime;for(var e in this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(0===this._valuesEnd[e].length)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}void 0!==this._object[e]&&(this._valuesStart[e]=this._object[e],this._valuesStart[e]instanceof Array==!1&&(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback.call(this._object,this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop()},delay:function(t){return this._delayTime=t,this},repeat:function(t){return this._repeat=t,this},repeatDelay:function(t){return this._repeatDelayTime=t,this},yoyo:function t(t){return this._yoyo=t,this},easing:function t(t){return this._easingFunction=t,this},interpolation:function t(t){return this._interpolationFunction=t,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(t){return this._onStartCallback=t,this},onUpdate:function(t){return this._onUpdateCallback=t,this},onComplete:function(t){return this._onCompleteCallback=t,this},onStop:function(t){return this._onStopCallback=t,this},update:function(t){var e,i,n;if(t<this._startTime)return!0;this._onStartCallbackFired===!1&&(null!==this._onStartCallback&&this._onStartCallback.call(this._object,this._object),this._onStartCallbackFired=!0),i=(t-this._startTime)/this._duration,i=i>1?1:i,n=this._easingFunction(i);for(e in this._valuesEnd)if(void 0!==this._valuesStart[e]){var s=this._valuesStart[e]||0,o=this._valuesEnd[e];o instanceof Array?this._object[e]=this._interpolationFunction(o,n):("string"==typeof o&&(o="+"===o.charAt(0)||"-"===o.charAt(0)?s+parseFloat(o):parseFloat(o)),
"number"==typeof o&&(this._object[e]=s+(o-s)*n))}if(null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._object,n),1===i){if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(e in this._valuesStartRepeat){if("string"==typeof this._valuesEnd[e]&&(this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(this._valuesEnd[e])),this._yoyo){var a=this._valuesStartRepeat[e];this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=a}this._valuesStart[e]=this._valuesStartRepeat[e]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback.call(this._object,this._object);for(var r=0,l=this._chainedTweens.length;r<l;r++)this._chainedTweens[r].start(this._startTime+this._duration);return!1}return!0}},a.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-a.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*a.Easing.Bounce.In(2*t):.5*a.Easing.Bounce.Out(2*t-1)+.5}}},a.Interpolation={Linear:function(t,e){var i=t.length-1,n=i*e,s=Math.floor(n),o=a.Interpolation.Utils.Linear;return e<0?o(t[0],t[1],n):e>1?o(t[i],t[i-1],i-n):o(t[s],t[s+1>i?i:s+1],n-s)},Bezier:function(t,e){for(var i=0,n=t.length-1,s=Math.pow,o=a.Interpolation.Utils.Bernstein,r=0;r<=n;r++)i+=s(1-e,n-r)*s(e,r)*t[r]*o(n,r);return i},CatmullRom:function(t,e){var i=t.length-1,n=i*e,s=Math.floor(n),o=a.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(s=Math.floor(n=i*(1+e))),o(t[(s-1+i)%i],t[s],t[(s+1)%i],t[(s+2)%i],n-s)):e<0?t[0]-(o(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[i]-(o(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):o(t[s?s-1:0],t[s],t[i<s+1?i:s+1],t[i<s+2?i:s+2],n-s)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=a.Interpolation.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i=1;if(t[e])return t[e];for(var n=e;n>1;n--)i*=n;return t[e]=i,i}}(),CatmullRom:function(t,e,i,n,s){var o=.5*(i-t),a=.5*(n-e),r=s*s,l=s*r;return(2*e-2*i+o+a)*l+(-3*e+3*i-2*o-a)*r+o*s+e}}},function(i){n=[],s=function(){return a}.apply(e,n),!(void 0!==s&&(t.exports=s))}(this)}).call(e,i(41))},function(t,e){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function s(t){if(c===setTimeout)return setTimeout(t,0);if((c===i||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function o(t){if(u===clearTimeout)return clearTimeout(t);if((u===n||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(t);try{return u(t)}catch(e){try{return u.call(null,t)}catch(e){return u.call(this,t)}}}function a(){f&&m&&(f=!1,m.length?p=m.concat(p):g=-1,p.length&&r())}function r(){if(!f){var t=s(a);f=!0;for(var e=p.length;e;){for(m=p,p=[];++g<e;)m&&m[g].run();g=-1,e=p.length}m=null,f=!1,o(t)}}function l(t,e){this.fun=t,this.array=e}function h(){}var c,u,d=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:i}catch(t){c=i}try{u="function"==typeof clearTimeout?clearTimeout:n}catch(t){u=n}}();var m,p=[],f=!1,g=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];p.push(new l(t,e)),1!==p.length||f||s(r)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=h,d.addListener=h,d.once=h,d.off=h,d.removeListener=h,d.removeAllListeners=h,d.emit=h,d.prependListener=h,d.prependOnceListener=h,d.listeners=function(t){return[]},d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(t,e){AFRAME.registerComponent("sound-fade",{schema:{from:{default:0},to:{default:1},duration:{default:1e3}},init:function(){this.el.getAttribute("sound")?(this.el.setAttribute("sound","volume",this.data.from),this.fadeEnded=!1,this.diff=this.data.to-this.data.from):this.fadeEnded=!0},update:function(t){this.endTime=void 0,this.fadeEnded=!1,this.diff=this.data.to-this.data.from},tick:function(t,e){if(!this.fadeEnded){if(void 0===this.endTime)return void(this.endTime=t+this.data.duration);var i=1-(this.endTime-t)/this.data.duration;i=Math.max(0,Math.min(1,i*i));var n=this.data.from+this.diff*i;this.el.setAttribute("sound","volume",n),1===i&&(this.fadeEnded=!0)}}})},function(t,e){AFRAME.registerComponent("restrict-position",{schema:{},init:function(){this.active=!AFRAME.utils.device.checkHeadsetConnected(),this.radius=2},tick:function(t,e){if(this.active){var i=new THREE.Vector3,n=this.el.object3D.position.y;i.copy(this.el.object3D.position);var s=this.radius/i.length();s<.98&&(i.multiplyScalar(this.radius/i.length()),this.el.setAttribute("position",{x:i.x,y:n,z:i.z}))}}})}]);